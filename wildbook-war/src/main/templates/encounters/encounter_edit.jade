div(layout="row" layout-wrap) 
    wb-individual-search(ng-show="module.individualSearch" flex="100" search-individual-done="searchIndividualDone(individual)")
    wb-individual-edit(ng-show="module.individualEdit" edit-individual-done="editIndividualDone(individual, deleted)" ind-data="data.encounter.individual" flex="100")
    form.form.ng-cloak(ng-show="! module.individualSearch && ! module.individualEdit"
                       name="encounterForm" novalidate, wb-key-handler-form flex="100")
        div(layout="row" flex="100" layout-align="start center")
            cancel-button(layout-margin cancel="cancel()")
            div.ml-10 {{autofilled}}
            span(flex)
            span {{data.encounter.id}}
            md-icon.md-warn(md-svg-icon="delete" ng-click="deleteEncounter()")
                md-tooltip(md-direction="bottom") Delete

        div(layout="row" layout-align="start center")
            div(layout="column")
                label Display Image:
                div(photo-dialog type="encounter" data="data.encounter" photo="data.encounter.displayImage" avatar="data.encounter.displayImage.thumbUrl" photos="data.photos")
            div(layout="column")
                label(layout-padding) Individual:
                div(layout="row" layout-align="start center")
                    img.avatar-icon(ng-if="data.encounter.individual.avatar" ng-src="{{data.encounter.individual.avatar}}")
                    input(ng-show="data.encounter.individual.id" type="text" disabled="true" ng-value="data.encounter.individual.displayNameFull")
                    md-input-container(ng-show="!data.encounter.individual.id")
                        label.brand-primary New
                        md-select(ng-model="data.encounter.individual.species" ng-model-options="{trackBy: '$value.code'}" placeholder="Species")
                            md-option(ng-value="species" ng-repeat="species in allSpecies") {{species.name}}
                    md-icon(md-svg-icon="pencil" ng-click="editIndividual()")
                        md-tooltip Edit Individual
                    md-icon(md-svg-icon="magnify" ng-click="findIndividual()")
                        md-tooltip Find Individual
        div.material-datepicker(layout="row" layout-wrap)
            md-datepicker(ng-model="dateObj" required md-placeholder="Date:" name="Date" ng-class="{'has-error': encounterForm.date.$invalid}")
            div.ml-20(layout="row")
                label Start Time:
                png-time-input(model="data.encounter.starttime" time-mode="24")
                span.ml-10.md-primary-text 24h
            div.ml-20(layout="row")
                label End Time:
                png-time-input(model="data.encounter.endtime" time-mode="24")
                span.ml-10.md-primary-text 24h
        div(ng-if="mapBuilt" ng-class="{'crosshair':locationPickerState}")
            leaflet(lf-center="mapData.center" layers="mapData.layers" markers="mapData.markers" tiles="mapData.tiles" height="300" defaults="mapData.defaults")
        div.mheight-5(layout="row")
            span(flex="")
            md-icon(md-svg-icon="crosshairs-gps" ng-click="pickLocation($event)" ng-class="{'green-svg':locationPickerState}")
                md-tooltip {{locationPickerState ? 'Disable Lat/Lng Picker' : 'Enable Lat/Lng Picker'}}
        md-tabs.overflow-visible(md-selected="selectedIndex" md-dynamic-height="true" md-border-bottom)
            md-tab(label="Data")
                div.mt-10(layout="row")
                    location-edit(location="data.encounter.location")
                md-input-container(layout="column")
                    label Comments
                    textarea(name="Comments" ng-model="data.encounter.comments")
            md-tab(label="Images")
                wb-thumb-box(ng-show="selectedIndex == 1"
                             photos="data.photos"
                             actions="tbActions"
                             thumbbox="data.selectedimgs"
                             cb-action="performAction(code, photos)"
                             pcb-action="checkPhotoCount(photos)")
        md-button.md-whiteframe-1dp(type="submit" ng-click="save()" aria-label="Save") Save
        
